var app=app||{};app.Tile=Backbone.Model.extend({defaults:{phrase:"",image:"",overlayImage:"img/default_overlay.gif",flipped:!1,matchFound:!1}}),app.Tiles=Backbone.Collection.extend({model:app.Tile}),app.TileView=Backbone.View.extend({tagName:"div",className:"tile",template:_.template('<img src="<%= flipped ? image : overlayImage %>" alt="<%= flipped ? phrase : "Guess?" %>">'),events:{"click .tile img":"revealTile"},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.model.get("matchFound")&&(this.$el.empty(),this.$el.toggleClass("hidden")),this},revealTile:function(){if(app.activeTiles.length<2){this.model.set("flipped",!0),this.$el.toggleClass("active"),this.render(),app.activeTiles.add(this.model),app.totalTries=app.totalTries+1;var a=app.activeTiles.pluck("phrase");2===a.length&&(a[0]==a[1]?this.success():this.failure())}},success:function(){app.activeTiles.each(function(a){a.set("matchFound",!0)}),$(".message").hide().text("Match Found!").slideDown(100);var a=this;setTimeout(function(){$(".message").text("Removed Matching tiles!").delay(1e3).fadeOut(500),a.finalize(),0===app.remainingTiles&&app.appView.gameComplete()},1500),app.remainingTiles=app.remainingTiles-2},failure:function(){app.activeTiles.each(function(a){a.set("flipped",!1)}),$(".message").text("Tiles do not match!"),app.appView.collection.add(app.activeTiles.toArray()),$(".message").hide().slideDown(100).delay(1e3).fadeOut(500);var a=this;setTimeout(function(){a.finalize()},1500)},finalize:function(){app.appView.render(),app.activeTiles.reset()}}),app.AppView=Backbone.View.extend({el:".board",collection:new app.Tiles,events:{"click .bttn":"restartGame"},scoresTemplate:_.template('<div class="scores"> <h1>Kudos! You Won!!</h1> <h2>Score = <%= scores %>%</h2> <a class="bttn large" href="#">Play Again</a> </div>'),initialize:function(){var a=this,b=this.randomNum(6,12);app.remainingTiles=app.numOfTiles=2*b,$.getJSON("/game/js/words.json",function(c){for(var d=0;b>d;d++)a.preloadImage(c.data[d].image),a.collection.add(c.data[d]),a.collection.add(c.data[d]);a.postInit()})},postInit:function(){this.collection.reset(this.collection.shuffle()),this.render()},render:function(){this.$el.empty(),_.each(this.collection.models,function(a){this.renderTile(a)},this)},renderTile:function(a){var b=new app.TileView({model:a});this.$el.append(b.render().el)},restartGame:function(){app.totalTries=0,app.activeTiles.reset(),this.collection.reset(),$("#wrap").slideDown(),this.initialize()},gameComplete:function(){this.collection.reset(),this.render(),$("#wrap").slideUp(),$(".message").hide();var a=Math.round(100*(app.numOfTiles/app.totalTries));this.$el.append(this.scoresTemplate({scores:a}))},randomNum:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},preloadImage:function(a){var b=new Image;b.src=a}}),$(function(){app.totalTries=0,app.activeTiles=new app.Tiles,app.appView=new app.AppView,app.reset=function(){app.totalTries=0,app.activeTiles.reset(),app.appView.restartGame()},$(".bttn").on("click",function(){app.reset()});var a=Math.floor;window.screen.availWidth>560&&$("html").on("mousemove",function(b){$("body").css({"background-position":a(b.pageX/-20)+"px "+a(b.pageY/-20)+"px"})})});